<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `monstorr-lib&#x2F;src&#x2F;attacks.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>attacks.rs - source</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../monstorr_lib/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">  1</span>
<span id="2">  2</span>
<span id="3">  3</span>
<span id="4">  4</span>
<span id="5">  5</span>
<span id="6">  6</span>
<span id="7">  7</span>
<span id="8">  8</span>
<span id="9">  9</span>
<span id="10"> 10</span>
<span id="11"> 11</span>
<span id="12"> 12</span>
<span id="13"> 13</span>
<span id="14"> 14</span>
<span id="15"> 15</span>
<span id="16"> 16</span>
<span id="17"> 17</span>
<span id="18"> 18</span>
<span id="19"> 19</span>
<span id="20"> 20</span>
<span id="21"> 21</span>
<span id="22"> 22</span>
<span id="23"> 23</span>
<span id="24"> 24</span>
<span id="25"> 25</span>
<span id="26"> 26</span>
<span id="27"> 27</span>
<span id="28"> 28</span>
<span id="29"> 29</span>
<span id="30"> 30</span>
<span id="31"> 31</span>
<span id="32"> 32</span>
<span id="33"> 33</span>
<span id="34"> 34</span>
<span id="35"> 35</span>
<span id="36"> 36</span>
<span id="37"> 37</span>
<span id="38"> 38</span>
<span id="39"> 39</span>
<span id="40"> 40</span>
<span id="41"> 41</span>
<span id="42"> 42</span>
<span id="43"> 43</span>
<span id="44"> 44</span>
<span id="45"> 45</span>
<span id="46"> 46</span>
<span id="47"> 47</span>
<span id="48"> 48</span>
<span id="49"> 49</span>
<span id="50"> 50</span>
<span id="51"> 51</span>
<span id="52"> 52</span>
<span id="53"> 53</span>
<span id="54"> 54</span>
<span id="55"> 55</span>
<span id="56"> 56</span>
<span id="57"> 57</span>
<span id="58"> 58</span>
<span id="59"> 59</span>
<span id="60"> 60</span>
<span id="61"> 61</span>
<span id="62"> 62</span>
<span id="63"> 63</span>
<span id="64"> 64</span>
<span id="65"> 65</span>
<span id="66"> 66</span>
<span id="67"> 67</span>
<span id="68"> 68</span>
<span id="69"> 69</span>
<span id="70"> 70</span>
<span id="71"> 71</span>
<span id="72"> 72</span>
<span id="73"> 73</span>
<span id="74"> 74</span>
<span id="75"> 75</span>
<span id="76"> 76</span>
<span id="77"> 77</span>
<span id="78"> 78</span>
<span id="79"> 79</span>
<span id="80"> 80</span>
<span id="81"> 81</span>
<span id="82"> 82</span>
<span id="83"> 83</span>
<span id="84"> 84</span>
<span id="85"> 85</span>
<span id="86"> 86</span>
<span id="87"> 87</span>
<span id="88"> 88</span>
<span id="89"> 89</span>
<span id="90"> 90</span>
<span id="91"> 91</span>
<span id="92"> 92</span>
<span id="93"> 93</span>
<span id="94"> 94</span>
<span id="95"> 95</span>
<span id="96"> 96</span>
<span id="97"> 97</span>
<span id="98"> 98</span>
<span id="99"> 99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
<span id="806">806</span>
<span id="807">807</span>
<span id="808">808</span>
<span id="809">809</span>
<span id="810">810</span>
<span id="811">811</span>
<span id="812">812</span>
<span id="813">813</span>
<span id="814">814</span>
<span id="815">815</span>
<span id="816">816</span>
<span id="817">817</span>
<span id="818">818</span>
<span id="819">819</span>
<span id="820">820</span>
<span id="821">821</span>
<span id="822">822</span>
<span id="823">823</span>
<span id="824">824</span>
<span id="825">825</span>
<span id="826">826</span>
<span id="827">827</span>
<span id="828">828</span>
<span id="829">829</span>
<span id="830">830</span>
<span id="831">831</span>
<span id="832">832</span>
<span id="833">833</span>
<span id="834">834</span>
<span id="835">835</span>
<span id="836">836</span>
<span id="837">837</span>
<span id="838">838</span>
<span id="839">839</span>
<span id="840">840</span>
<span id="841">841</span>
<span id="842">842</span>
<span id="843">843</span>
<span id="844">844</span>
<span id="845">845</span>
<span id="846">846</span>
<span id="847">847</span>
<span id="848">848</span>
<span id="849">849</span>
<span id="850">850</span>
<span id="851">851</span>
<span id="852">852</span>
<span id="853">853</span>
<span id="854">854</span>
<span id="855">855</span>
<span id="856">856</span>
<span id="857">857</span>
<span id="858">858</span>
<span id="859">859</span>
<span id="860">860</span>
<span id="861">861</span>
<span id="862">862</span>
<span id="863">863</span>
<span id="864">864</span>
<span id="865">865</span>
<span id="866">866</span>
<span id="867">867</span>
<span id="868">868</span>
<span id="869">869</span>
<span id="870">870</span>
<span id="871">871</span>
<span id="872">872</span>
<span id="873">873</span>
<span id="874">874</span>
<span id="875">875</span>
<span id="876">876</span>
<span id="877">877</span>
<span id="878">878</span>
<span id="879">879</span>
<span id="880">880</span>
<span id="881">881</span>
<span id="882">882</span>
<span id="883">883</span>
<span id="884">884</span>
<span id="885">885</span>
<span id="886">886</span>
<span id="887">887</span>
<span id="888">888</span>
<span id="889">889</span>
<span id="890">890</span>
<span id="891">891</span>
<span id="892">892</span>
<span id="893">893</span>
<span id="894">894</span>
<span id="895">895</span>
<span id="896">896</span>
<span id="897">897</span>
<span id="898">898</span>
<span id="899">899</span>
<span id="900">900</span>
<span id="901">901</span>
<span id="902">902</span>
<span id="903">903</span>
<span id="904">904</span>
<span id="905">905</span>
<span id="906">906</span>
<span id="907">907</span>
<span id="908">908</span>
<span id="909">909</span>
<span id="910">910</span>
<span id="911">911</span>
<span id="912">912</span>
<span id="913">913</span>
<span id="914">914</span>
<span id="915">915</span>
<span id="916">916</span>
<span id="917">917</span>
<span id="918">918</span>
<span id="919">919</span>
<span id="920">920</span>
<span id="921">921</span>
<span id="922">922</span>
<span id="923">923</span>
<span id="924">924</span>
<span id="925">925</span>
<span id="926">926</span>
<span id="927">927</span>
<span id="928">928</span>
<span id="929">929</span>
<span id="930">930</span>
<span id="931">931</span>
<span id="932">932</span>
<span id="933">933</span>
<span id="934">934</span>
<span id="935">935</span>
<span id="936">936</span>
<span id="937">937</span>
<span id="938">938</span>
<span id="939">939</span>
<span id="940">940</span>
<span id="941">941</span>
<span id="942">942</span>
<span id="943">943</span>
<span id="944">944</span>
<span id="945">945</span>
<span id="946">946</span>
<span id="947">947</span>
<span id="948">948</span>
<span id="949">949</span>
<span id="950">950</span>
<span id="951">951</span>
<span id="952">952</span>
<span id="953">953</span>
<span id="954">954</span>
<span id="955">955</span>
<span id="956">956</span>
<span id="957">957</span>
<span id="958">958</span>
<span id="959">959</span>
<span id="960">960</span>
<span id="961">961</span>
<span id="962">962</span>
<span id="963">963</span>
<span id="964">964</span>
<span id="965">965</span>
<span id="966">966</span>
<span id="967">967</span>
<span id="968">968</span>
<span id="969">969</span>
<span id="970">970</span>
<span id="971">971</span>
<span id="972">972</span>
<span id="973">973</span>
<span id="974">974</span>
<span id="975">975</span>
</pre><pre class="rust"><code><span class="comment">/*
 * Copyright © 2022 Neil M. Sheldon
 * 
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */</span>

<span class="kw">use</span> <span class="ident">serde::Deserialize</span>;
<span class="kw">use</span> <span class="ident">serde::Serialize</span>;

<span class="kw">use</span> <span class="ident"><span class="kw">crate</span>::stats::Damage</span>;
<span class="kw">use</span> <span class="ident"><span class="kw">crate</span>::dice::Die</span>;
<span class="kw">use</span> <span class="ident"><span class="kw">crate</span>::dice::Dice</span>;
<span class="kw">use</span> <span class="ident"><span class="kw">crate</span>::dice_expression::DiceExpression</span>;
<span class="kw">use</span> <span class="ident"><span class="kw">crate</span>::stats::Ability</span>;
<span class="kw">use</span> <span class="ident"><span class="kw">crate</span>::stats::CreatureSize</span>;



<span class="comment">// An AttackEffect specifies the result of an attack hitting a target</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">PartialEq</span>,<span class="ident">Debug</span>,<span class="ident">Clone</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Serialize</span>,<span class="ident">Deserialize</span>)]</span>
<span class="doccomment">/**
An attack effect represents the results of an attack, or an action in general. Usually, this effect is to cause damage to the target, but there are also other choices. Many of the variants here are based on conditional results, which cause different damage or types of damage based on that condition. These conditions change the wording of the descriptions created with the effect, even if they don&#39;t change the damage per round.

You are usually looking for the `Damage` variant. Some other value types referenced include [`AttackBonus`] and [`crate::stats::Damage`]. The attack bonus is a way to reference the stats of the creature to generate the bonus.

All string arguments are subject to interpolation in the final description.
*/</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">AttackEffect</span> {
    <span class="comment">// FUTURE: I&#39;m using DiceExpression here instead of Dice, despite having a separate bonus, because that&#39;s</span>
    <span class="comment">// the only way to add the magic bonus to the dice. See the next note regarding optional arguments for why I</span>
    <span class="comment">// don&#39;t just have a &lt;dice&gt; and an optional magic bonus. This one could also be fixed with a custom deserialization.</span>
    <span class="comment">// FUTURE: Attempting to &quot;skip&quot; the AttackBonus arguments breaks things since the deserialization can&#39;t figure</span>
    <span class="comment">// out that it should go on to the next if it can&#39;t find it. That sort of thing only works in the last argument.</span>
    <span class="comment">// the only solutions I can think of are to change these to structs, in which case it gets too wordy, or</span>
    <span class="comment">// customize the serializing/deserializing, which is not worth the trouble since serde makes these things</span>
    <span class="comment">// harder than they should be. A future version of monstorr which does it&#39;s own parsing (since we&#39;ve implemented</span>
    <span class="comment">// a parser anyway) might fix all of this, as it would allow me to specify true function overloads, but that</span>
    <span class="comment">// is reserved for some day in the future instead.</span>

    <span class="doccomment">/**
    `Damage(&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;)`

    The attack causes the rolled amount of specified damage type.
    */</span>
    <span class="ident">Damage</span>(<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>),
    <span class="doccomment">/**
    `FixedDamage(&lt;integer&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;)`

    The attack causes a fixed amount of damage every time it is used. This is used for attacks like unarmed strikes, where the damage started as a fixed value of 1, but with magic or size bonuses increased by a specified amount. It really shouldn&#39;t be used for regular attacks.
    */</span>
    <span class="ident">FixedDamage</span>(<span class="ident">u8</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>), <span class="comment">// fixed amount, magic, bonus, damage type</span>
    <span class="doccomment">/**
    `Special(&lt;string&gt;)`

    The attack causes an effect that would not change damage per round. This might be a condition effect such as grappled or poisoned, or non-immediate damage that continues per turn until something happens. These would have to be artificially added to the damage per round later.

    In order to make descriptions work, the sentence should be worded something like &quot;the target is...&quot;.
    */</span>
    <span class="ident">Special</span>(<span class="ident">String</span>),
    <span class="doccomment">/**
    `Or(&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;,&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;,&lt;String&gt;)`

    If an attack can have two results depending on some condition, this can be used. The wording of the attack is will be &quot;&lt;damage&gt; or &lt;damage&gt; &lt;condition&gt;.&quot;. You should specify an &quot;if&quot;, &quot;while&quot; or other conditional in the last string.
    */</span>
    <span class="ident">Or</span>(<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>,<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>,<span class="ident">String</span>),
    <span class="doccomment">/**
    `DoubleOr(&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;,&lt;string&gt;,&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;,&lt;String&gt;)`

    This is similare to `or`, except there is a condition attached to both results. The wording of the attack is will be &quot;&lt;damage&gt; &lt;first condition&gt; or &lt;damage&gt; &lt;second condition&gt;.&quot;. You should specify an &quot;if&quot;, &quot;while&quot; or other conditional in the strings.
    */</span>
    <span class="ident">DoubleOr</span>(<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>,<span class="ident">String</span>,<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>,<span class="ident">String</span>),
    <span class="doccomment">/**
    `DjinnisChoice(&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;,&lt;Damage&gt;)`

    In the core books, the djinni has a choice between the damage types it can cause. This is abstracted from that, and will result in the wording &quot;&lt;dice&gt; &lt;damage&gt; or &lt;damage&gt; damage (${poss} choice)&quot;.
    */</span>
    <span class="ident">DjinnisChoice</span>(<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>,<span class="ident">Damage</span>),
    <span class="doccomment">/**
    `SaveAll(&lt;integer&gt;,&lt;Ability&gt;,&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;)`

    The target must make a saving roll, and only takes damage if they succeed. The initial number is the DC for the saving roll. See [`crate::stats::Ability`].
    */</span>
    <span class="ident">SaveAll</span>(<span class="ident">u8</span>,<span class="ident">Ability</span>,<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>),
    <span class="doccomment">/**
    `SaveHalf(&lt;integer&gt;,&lt;Ability&gt;,&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;)`

    The target must make a saving roll, and takes half damage if they succeed. The initial number is the DC for the saving roll.  See [`crate::stats::Ability`].
    */</span>
    <span class="ident">SaveHalf</span>(<span class="ident">u8</span>,<span class="ident">Ability</span>,<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>),


    <span class="doccomment">/**
    `AreaDamage(&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;)`

    This causes damage to all targets in an area.
    */</span>
    <span class="ident">AreaDamage</span>(<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>),
    <span class="doccomment">/**
    `AreaSaveAll(&lt;integer&gt;,&lt;Ability&gt;,&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;)`

    This is the `SaveAll` version for `AreaDamage`.
    */</span>
    <span class="ident">AreaSaveAll</span>(<span class="ident">u8</span>,<span class="ident">Ability</span>,<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>),
    <span class="doccomment">/**
    `AreaSaveHalf(&lt;integer&gt;,&lt;Ability&gt;,&lt;dice-expression-string&gt;,&lt;AttackBonus&gt;,&lt;Damage&gt;)`

    This is the `SaveHalf` version for `AreaDamage`.
    */</span>
    <span class="ident">AreaSaveHalf</span>(<span class="ident">u8</span>,<span class="ident">Ability</span>,<span class="ident">DiceExpression</span>,<span class="ident">AttackBonus</span>,<span class="ident">Damage</span>),
}

<span class="kw">impl</span> <span class="ident">AttackEffect</span> {

    <span class="kw">fn</span> <span class="ident">get_base_description</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">default_bonus</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">String</span> {
        <span class="kw">match</span> <span class="self">self</span> {
            <span class="ident">AttackEffect::FixedDamage</span>(<span class="ident">amount</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>) <span class="op">=</span><span class="op">&gt;</span> 
                <span class="macro">format!</span>(<span class="string">&quot;${{{} + {}}} {} damage&quot;</span>,
                        <span class="ident">amount</span>,
                        <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">damage</span>),
            <span class="ident">AttackEffect::Damage</span>(<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>) <span class="op">=</span><span class="op">&gt;</span> 
                <span class="macro">format!</span>(<span class="string">&quot;${{{} + {}}} {} damage&quot;</span>,
                        <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                        <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">damage</span>),
            <span class="ident">AttackEffect::Special</span>(<span class="ident">special</span>) <span class="op">=</span><span class="op">&gt;</span> 
                <span class="ident">special</span>.<span class="ident">clone</span>(),
            <span class="ident">AttackEffect::Or</span>(<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>,<span class="ident">alt_dice</span>,<span class="ident">alt_bonus</span>,<span class="ident">alt_damage</span>,<span class="ident">condition</span>) <span class="op">=</span><span class="op">&gt;</span> 
                <span class="macro">format!</span>(<span class="string">&quot;${{{} + {}}} {} damage or ${{{} + {}}} {} damage {}&quot;</span>,
                        <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                        <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">damage</span>,
                        <span class="ident">alt_dice</span>.<span class="ident">serialize_to_string</span>(),
                        <span class="ident">alt_bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">alt_damage</span>,
                        <span class="ident">condition</span>),
            <span class="ident">AttackEffect::DoubleOr</span>(<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>,<span class="ident">condition</span>,<span class="ident">alt_dice</span>,<span class="ident">alt_bonus</span>,<span class="ident">alt_damage</span>,<span class="ident">alt_condition</span>) <span class="op">=</span><span class="op">&gt;</span> 
                <span class="macro">format!</span>(<span class="string">&quot;${{{} + {}}} {} damage {} or ${{{} + {}}} {} damage {}&quot;</span>,
                        <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                        <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">damage</span>,
                        <span class="ident">condition</span>,
                        <span class="ident">alt_dice</span>.<span class="ident">serialize_to_string</span>(),
                        <span class="ident">alt_bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">alt_damage</span>,
                        <span class="ident">alt_condition</span>),
            <span class="comment">// The Djinni, at least, has a &quot;plus&quot; effect for which it can choose between two types of damage</span>
            <span class="ident">AttackEffect::DjinnisChoice</span>(<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>,<span class="ident">alt_damage</span>) <span class="op">=</span><span class="op">&gt;</span>
               <span class="macro">format!</span>(<span class="string">&quot;${{{} + {}}} {} or {} damage (${{poss}} choice)&quot;</span>,
                       <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                       <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                       <span class="ident">damage</span>,
                       <span class="ident">alt_damage</span>),
            <span class="comment">// Represents an attack result which only causes damage if the target fails to save on a certain ability.</span>
            <span class="ident">AttackEffect::SaveAll</span>(<span class="ident">save_dc</span>,<span class="ident">save_ability</span>,<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>) <span class="op">=</span><span class="op">&gt;</span>
               <span class="macro">format!</span>(<span class="string">&quot;The target must make a DC {} {} saving throw, taking ${{{} + {}}} {} damage on a failed save&quot;</span>,
                       <span class="ident">save_dc</span>,
                       <span class="ident">save_ability</span>,
                       <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                       <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                       <span class="ident">damage</span>),
            <span class="ident">AttackEffect::SaveHalf</span>(<span class="ident">save_dc</span>,<span class="ident">save_ability</span>,<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>) <span class="op">=</span><span class="op">&gt;</span>
               <span class="macro">format!</span>(<span class="string">&quot;The target must make a DC {} {} saving throw, taking ${{{} + {}}} {} damage on a failed save, or half as much damage on a successful one&quot;</span>,
                       <span class="ident">save_dc</span>,
                       <span class="ident">save_ability</span>,
                       <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                       <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                       <span class="ident">damage</span>),
            <span class="ident">AttackEffect::AreaDamage</span>(<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="comment">// FUTURE: I don&#39;t know which creature I got this from, so wording might be wrong.</span>
                <span class="macro">format!</span>(<span class="string">&quot;Each target in the area takes ${{{} + {}}} {} damage&quot;</span>,
                       <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                       <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                       <span class="ident">damage</span>),
            <span class="ident">AttackEffect::AreaSaveAll</span>(<span class="ident">save_dc</span>,<span class="ident">save_ability</span>,<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>) <span class="op">=</span><span class="op">&gt;</span>
                <span class="macro">format!</span>(<span class="string">&quot;Each target in the area must make a DC {} {} saving throw, taking ${{{} + {}}} {} damage on a failed save&quot;</span>,
                        <span class="ident">save_dc</span>,
                        <span class="ident">save_ability</span>,
                        <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                        <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">damage</span>),
            <span class="ident">AttackEffect::AreaSaveHalf</span>(<span class="ident">save_dc</span>,<span class="ident">save_ability</span>,<span class="ident">dice</span>,<span class="ident">bonus</span>,<span class="ident">damage</span>) <span class="op">=</span><span class="op">&gt;</span>
                <span class="macro">format!</span>(<span class="string">&quot;Each target in the area must make a DC {} {} saving throw, taking ${{{} + {}}} {} damage on a failed save, or half as much damage on a successful one&quot;</span>,
                        <span class="ident">save_dc</span>,
                        <span class="ident">save_ability</span>,
                        <span class="ident">dice</span>.<span class="ident">serialize_to_string</span>(),
                        <span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="ident">default_bonus</span>,<span class="bool-val">false</span>),
                        <span class="ident">damage</span>),
        }
    }

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">get_description</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">default_bonus</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>, <span class="ident">compound</span>: <span class="kw-2">&amp;</span><span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">CompoundAttackEffect</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">String</span> {
        <span class="kw">let</span> <span class="ident">base</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>);
        <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Some</span>(<span class="ident">compound</span>) <span class="op">=</span> <span class="ident">compound</span> {

            <span class="kw">match</span> <span class="ident">compound</span> {
                <span class="ident">CompoundAttackEffect::And</span>(<span class="ident">alt_attack</span>) <span class="op">=</span><span class="op">&gt;</span> 
                    <span class="macro">format!</span>(<span class="string">&quot;{}, and {}.&quot;</span>,<span class="ident">base</span>,<span class="ident">alt_attack</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>)),
                <span class="ident">CompoundAttackEffect::AndAnd</span>(<span class="ident">alt_attack</span>,<span class="ident">and</span>) <span class="op">=</span><span class="op">&gt;</span> 
                    <span class="macro">format!</span>(<span class="string">&quot;{}, and {} and {}.&quot;</span>,<span class="ident">base</span>,<span class="ident">alt_attack</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>),<span class="ident">and</span>),
                <span class="ident">CompoundAttackEffect::Additional</span>(<span class="ident">alt_attack</span>) <span class="op">=</span><span class="op">&gt;</span> 
                    <span class="macro">format!</span>(<span class="string">&quot;{}. {}.&quot;</span>,<span class="ident">base</span>,<span class="ident">alt_attack</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>)),
                <span class="ident">CompoundAttackEffect::AndAdditional</span>(<span class="ident">first_alt</span>,<span class="ident">second_alt</span>) <span class="op">=</span><span class="op">&gt;</span> 
                    <span class="macro">format!</span>(<span class="string">&quot;{}, and {}. {}.&quot;</span>,<span class="ident">base</span>,<span class="ident">first_alt</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>),<span class="ident">second_alt</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>)),
                <span class="ident">CompoundAttackEffect::Plus</span>(<span class="ident">alt</span>) <span class="op">=</span><span class="op">&gt;</span>
                    <span class="macro">format!</span>(<span class="string">&quot;{} plus {}.&quot;</span>,<span class="ident">base</span>,<span class="ident">alt</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>)),
                <span class="ident">CompoundAttackEffect::PlusAdditional</span>(<span class="ident">first</span>,<span class="ident">second</span>) <span class="op">=</span><span class="op">&gt;</span>
                    <span class="macro">format!</span>(<span class="string">&quot;{} plus {}. {}.&quot;</span>,<span class="ident">base</span>,<span class="ident">first</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>),<span class="ident">second</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>)),
                <span class="ident">CompoundAttackEffect::PlusAnd</span>(<span class="ident">first</span>,<span class="ident">second</span>) <span class="op">=</span><span class="op">&gt;</span> 
                    <span class="macro">format!</span>(<span class="string">&quot;{} plus {}, and {}.&quot;</span>,<span class="ident">base</span>,<span class="ident">first</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>),<span class="ident">second</span>.<span class="ident">get_base_description</span>(<span class="ident">default_bonus</span>))
            }
        } <span class="kw">else</span> {
            <span class="macro">format!</span>(<span class="string">&quot;{}.&quot;</span>,<span class="ident">base</span>)
        }

    }
}

<span class="comment">// A CompoundAttackEffect specifies additional results of an attack hitting a target, much of these</span>
<span class="comment">// differ only in the wording provided in the calculated description</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">PartialEq</span>,<span class="ident">Debug</span>,<span class="ident">Clone</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Serialize</span>,<span class="ident">Deserialize</span>)]</span>
<span class="doccomment">/**
Some creatures cause extra damage or other effects when they have a successful attack. It was simpler to model this as a separate structure, rather than add a lot more choices to the [`Attack`] variant. Many of the variants in the CompoundAttackEffect simply add one more effect. However, the compound attack effect can be used to generate a description, and the variants given can be used to generate descriptions for 95% of the attacks on creatures in the core books.

For more information on the actual effects, see [`AttackEffect`].

*/</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">CompoundAttackEffect</span> {
    <span class="doccomment">/**
    `And(&lt;AttackEffect&gt;)`

    The resulting description of the attack has the format &quot;&lt;original effect&gt;, and &lt;next effect&gt;.&quot;
    */</span>
    <span class="ident">And</span>(<span class="ident">AttackEffect</span>),
    <span class="doccomment">/**
    `AndAnd(&lt;AttackEffect&gt;,&lt;string&gt;)`

    This is used where the second effect is a SavAll or SaveHalf, and there are additional effects that occur if the save is failed.

    The resulting description of the attack has the format &quot;&lt;original effect&gt;, and &lt;next effect&gt; and &lt;string&gt;.&quot; The string can contain interpolation content.

    */</span>
    <span class="ident">AndAnd</span>(<span class="ident">AttackEffect</span>,<span class="ident">String</span>),
    <span class="doccomment">/**
    `Additional(&lt;AttackEffect&gt;,&lt;string&gt;)`

    This is similar to `AndAnd`, but used where the additional effects occur all the time. Usually, the next effect is a `Special` that doesn&#39;t change damage per round.

    The resulting description of the attack has the format &quot;&lt;original effect&gt;. &lt;next effect&gt;.&quot;
    */</span>
    <span class="ident">Additional</span>(<span class="ident">AttackEffect</span>),
    <span class="doccomment">/**
    `AndAdditional(&lt;AttackEffect&gt;,&lt;AttackEffect&gt;)`

    This is a combination of `And` and `Additional`.

    The resulting description of the attack has the format &quot;&lt;original effect&gt;, and &lt;next efffect&gt;. &lt;last effect&gt;.&quot;
    */</span>
    <span class="ident">AndAdditional</span>(<span class="ident">AttackEffect</span>,<span class="ident">AttackEffect</span>),
    <span class="doccomment">/**
    `Plus(&lt;AttackEffect&gt;)`

    While similar to `And`, this changes the wording to use &quot;plus&quot;. There is little semantic difference between the two, I believe that some of the writers of the core books just wanted to add a little variety. This wording does help with the `PlusAnd` variant, however.

    The resulting description of the attack has the format &quot;&lt;original effect&gt; plus &lt;next effect&gt;.&quot;
    */</span>
    <span class="ident">Plus</span>(<span class="ident">AttackEffect</span>),
    <span class="doccomment">/**
    `PlusAdditional(&lt;AttackEffect&gt;,&lt;AttackEffect&gt;)`

    This is a combination of `Plus` and `Additional`.

    The resulting description of the attack has the format &quot;&lt;original effect&gt; plus &lt;next efffect&gt;. &lt;last effect&gt;.&quot;
    */</span>
    <span class="ident">PlusAdditional</span>(<span class="ident">AttackEffect</span>,<span class="ident">AttackEffect</span>),
    <span class="doccomment">/**
    `PlusAnd(&lt;AttackEffect&gt;,&lt;AttackEffect&gt;)`

    This is great for when you have two damaging effects.

    The resulting description of the attack has the format &quot;&lt;original effect&gt; plus &lt;next effect&gt;, and &lt;last effect&gt;.&quot;
    */</span>
    <span class="comment">// &lt;original effect&gt; + &quot;plus (...), and (...)&quot; -- the &#39;and&#39; is usually non-DPR effect</span>
    <span class="ident">PlusAnd</span>(<span class="ident">AttackEffect</span>,<span class="ident">AttackEffect</span>)

}


<span class="comment">// FUTURE: I&#39;d like to change how this (de)serializes:</span>
<span class="comment">// -- anywhere there is a Vec, I want the enum to flatten out the vec into arguments. So, Or([...]) becomes Or(...), count(1,[...]) becomes count(1,...)</span>
<span class="comment">// -- anywhere there an &quot;Attack&quot;, it should be serialized only as a string</span>
<span class="comment">// but I can also see how those options might be inconsistent with the rest. Instead, perhaps go back to the original wording of things in the SRD and</span>
<span class="comment">// match the structures more to those somehow.</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">PartialEq</span>,<span class="ident">Debug</span>,<span class="ident">Clone</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Serialize</span>,<span class="ident">Deserialize</span>)]</span>
<span class="doccomment">/**
The description for a &quot;Multiattack&quot; action is written by hand, not generated from multiattack values. The Multiattack value&#39;s primary use is for calculating the Challenge Rating, as that calculation needs to know what attacks a creature can make in each round. While the challenge rating is not yet automatically calculated, it is good to have this information for when it will be.

A Multiattack is a simple structure complicated by multiple combinations. While some creatures can simply make any attacks of their attacks a certain number of times, others are limited in unusual ways. For example, a creature might be able to make one bite and two claw attacks. Another might make three melee, but only one spell, and if they attack with their staff they can only attack twice. There are few very complicated multiattacks in the official books, but being able to model even a mixed multiattack like that first requires a few unusual structures. 

Many of the Multiattack variants are recursive, taking vectors of other multiattacks as arguments. The other values simple specify what types of attacks should be used in those arguments. All attacks reference non-legendary actions.
 */</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">Multiattack</span> {
    <span class="doccomment">/**
    `Any`

    The creature can attack with any of its attacks.
    */</span>
    <span class="ident">Any</span>,
    <span class="doccomment">/**
    `Ranged`

    The creature can make any ranged attack once.
    */</span>
    <span class="ident">Ranged</span>, 
    <span class="doccomment">/**
    `Melee`

    The creature can make any melee attack once.
    */</span>
    <span class="ident">Melee</span>, 
    <span class="doccomment">/**
    `Spell`

    The creature can make a any spell attack once, or cast one spell that normally takes an action to do so.
    */</span>
    <span class="ident">Spell</span>, 
    <span class="doccomment">/**
    `Attack(&lt;string&gt;)`

    The creature takes the specified action once. If the attack has not been added by the end of creature completion, an error will be reported.
    */</span>
    <span class="ident">Attack</span>(<span class="ident">String</span>), 
    <span class="doccomment">/**
    `Weapon(&lt;weapon&gt;)`

    The creature attacks with the specified weapon once. If the weapon has not been added by the end of creature completion, an error will be reported.
    */</span>
    <span class="ident">Weapon</span>(<span class="ident">Weapon</span>),
    <span class="doccomment">/**
    `Except([&lt;Multiattack&gt;...])`

    The creature makes any attack, except the ones specified, once.
    */</span>
    <span class="ident">Except</span>(<span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Multiattack</span><span class="op">&gt;</span>), 
    <span class="doccomment">/**
    `Or([&lt;Multiattack&gt;...])`

    The creature makes one of the attacks specified. 
    */</span>
    <span class="ident">Or</span>(<span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Multiattack</span><span class="op">&gt;</span>),
    <span class="doccomment">/**
    `Count(&lt;integer&gt;,[&lt;Multiattack&gt;...])`

    The creature uses any of the listed attacks the specified number of times.
    */</span>
    <span class="ident">Count</span>(<span class="ident">u8</span>,<span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Multiattack</span><span class="op">&gt;</span>),
    <span class="doccomment">/**
    `And([&lt;Multiattack&gt;...])`

    The creature makes all of the specified attacks.
    */</span>
    <span class="ident">And</span>(<span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Multiattack</span><span class="op">&gt;</span>),
    <span class="doccomment">/**
    `Dice(&lt;dice-expression-string&gt;,[&lt;Multiattack&gt;...])`

    The creature makes any of the specified attacks the number of times determined by a dice roll.

    In the core books, this version is used by the Violet Fungus.
    */</span>
    <span class="ident">Dice</span>(<span class="ident">DiceExpression</span>,<span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Multiattack</span><span class="op">&gt;</span>) <span class="comment">// roll the specified die to determine how many of any one of these specified attacks</span>
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">PartialEq</span>,<span class="ident">Debug</span>,<span class="ident">Clone</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Serialize</span>,<span class="ident">Deserialize</span>)]</span>
<span class="doccomment">/**
These values are used to indicate what abilities attack bonuses will come from. For hit rolls, these bonuses are added to the proficiency bonus. For damage, these abilities are used alone.
*/</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">AttackBonus</span> {
    <span class="doccomment">/**
    `Default`

    Specifies that the attack bonus is determined by the type of attack. If it is a melee attack, use Strength, if it is ranged, use Dexterity. If it is both kinds of attacks, the attack is assumed to be a flexible weapon, and the best of each of those is chosen.
    */</span>
    <span class="ident">Default</span>,
    <span class="doccomment">/**
    `Strength`

    Use Strength for the bonus.
    */</span>
    <span class="ident">Strength</span>, 
    
    <span class="doccomment">/**
    `Dexterity`

    Use Dexterity for the bonus.
    */</span>
    <span class="ident">Dexterity</span>,
    
    <span class="doccomment">/**
    `Constitution`

    Use Constitution for the bonus.
    */</span>
    <span class="ident">Constitution</span>,
    
    <span class="doccomment">/**
    `Wisdom`

    Use Wisdom for the bonus.
    */</span>
    <span class="ident">Wisdom</span>,
    
    <span class="doccomment">/**
    `Intelligence`

    Use Intelligence for the bonus.
    */</span>
    <span class="ident">Intelligence</span>,
    
    <span class="doccomment">/**
    `Charisma`

    Use Charisma for the bonus.
    */</span>
    <span class="ident">Charisma</span>,
    <span class="doccomment">/**
    `Best`

    The attack bonus is calculated based on the best of Strength or Dexterity.
    */</span>
    <span class="ident">Best</span>,
    <span class="doccomment">/**
    `Spell`

    The attack bonus is calculated based on the creature&#39;s spell attack bonus. If the creature has both innate and regular spellcasting, the innate spellcasting bonus is taken. This will cause interpolation errors if the creature has no spellcasting ability.
    */</span>
    <span class="ident">Spell</span>,
    <span class="doccomment">/**
    `Fixed(&lt;integer&gt;)`

    The attack bonus is fixed to the specific value, and not based on ability.
    */</span>
    <span class="ident">Fixed</span>(<span class="ident">u8</span>),
    <span class="doccomment">/**
    `Zero`
    
    The attack bonus is 0. This has the same effect as `Fixed(0)
    */</span>
    <span class="ident">Zero</span>
}

<span class="kw">impl</span> <span class="ident">AttackBonus</span> {

    <span class="kw">fn</span> <span class="ident">is_default</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">bool</span> {
        <span class="kw">if</span> <span class="kw">let</span> <span class="ident">AttackBonus::Default</span> <span class="op">=</span> <span class="self">self</span> {
            <span class="bool-val">true</span>
        } <span class="kw">else</span> {
            <span class="bool-val">false</span>
        }
    }

    <span class="comment">// get the interpolation expression</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">get_expr</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">default</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>, <span class="ident">use_prof</span>: <span class="ident">bool</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">String</span> {
        <span class="kw">match</span> <span class="self">self</span> {
            <span class="ident">AttackBonus::Default</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;{}{}&quot;</span>,<span class="ident">default</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Strength</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;str{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Dexterity</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;dex{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Constitution</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;con{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Wisdom</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;wis{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Intelligence</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;int{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Charisma</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;cha{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Best</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;atk{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Spell</span> <span class="op">=</span><span class="op">&gt;</span> <span class="macro">format!</span>(<span class="string">&quot;spell_atk{}&quot;</span>,<span class="kw">if</span> <span class="ident">use_prof</span> { <span class="string">&quot; + prof&quot;</span> } <span class="kw">else</span> { <span class="string">&quot;&quot;</span> }),
            <span class="ident">AttackBonus::Fixed</span>(<span class="ident">number</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="ident">number</span>.<span class="ident">to_string</span>(),
            <span class="ident">AttackBonus::Zero</span> <span class="op">=</span><span class="op">&gt;</span> <span class="string">&quot;0&quot;</span>.<span class="ident">to_owned</span>(),
        }
    }
}

<span class="kw">impl</span> <span class="ident">Default</span> <span class="kw">for</span> <span class="ident">AttackBonus</span> {

    <span class="kw">fn</span> <span class="ident">default</span>() <span class="op">-</span><span class="op">&gt;</span> <span class="self">Self</span> {
        <span class="ident">AttackBonus::Default</span>
    }
}

<span class="kw">impl</span> <span class="ident">std::convert::TryFrom</span><span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">AttackBonus</span> {

    <span class="kw">type</span> <span class="ident">Error</span> <span class="op">=</span> <span class="ident">String</span>; <span class="comment">// I just need something that implements display, since I won&#39;t ever be returning an error.</span>

    <span class="kw">fn</span> <span class="ident">try_from</span>(<span class="ident">input</span>: <span class="ident">u8</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="self">Self</span>,<span class="ident"><span class="self">Self</span>::Error</span><span class="op">&gt;</span> {
        <span class="prelude-val">Ok</span>(<span class="ident">AttackBonus::Fixed</span>(<span class="ident">input</span>))
    }

}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">PartialEq</span>,<span class="ident">Debug</span>,<span class="ident">Clone</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Serialize</span>,<span class="ident">Deserialize</span>)]</span>
<span class="doccomment">/**
Used for adding the words &quot;Weapon&quot; or &quot;Spell&quot; into the type of the attack.
*/</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">AttackType</span> {
    <span class="doccomment">/// `Weapon`</span>
    <span class="ident">Weapon</span>,
    <span class="doccomment">/// `Spell`</span>
    <span class="ident">Spell</span>
}


<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">PartialEq</span>,<span class="ident">Debug</span>,<span class="ident">Clone</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Serialize</span>,<span class="ident">Deserialize</span>)]</span>
<span class="doccomment">/**
`(type: option(&lt;AttackType&gt;)?, bonus: &lt;AttackBonus&gt;?, magic: option(&lt;integer&gt;)?, reach: option(&lt;integer&gt;)?, range: option(&lt;integer&gt;)?, long_range: option(&lt;integer&gt;)?, target: &lt;string&gt;)`

An Attack value is a mapped struct containing data needed to generating a description, of the attack attempt of an action. This is the part before the &quot;hit:&quot; phrasing. See below for what the various properties mean.

To specify that an attack can be melee, give it a reach property. To specify that it can be ranged, give it a range property.

*/</span>
<span class="comment">// FUTURE: I&#39;d like to be able to make the optional properties simply not required in deserialization, with the &#39;Some&#39; automatically added if it&#39;s not there. This and in all places.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Attack</span> {
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">skip_serializing_if</span> <span class="op">=</span> <span class="string">&quot;Option::is_none&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">default</span>)]</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">rename</span><span class="op">=</span><span class="string">&quot;type&quot;</span>)]</span>
    <span class="doccomment">/**
    `type: option(&lt;AttackType&gt;)?`

    Specifies the [`AttackType`]. The possible values are `Weapon` and `Spell`, but this is optional. The resulting phrasing will say things like &quot;Melee Weapon Attack&quot; or &quot;Ranged Spell Attack&quot;, with the word removed if this is not specified.
    */</span>
    <span class="kw">pub</span> <span class="ident">type_</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">AttackType</span><span class="op">&gt;</span>,
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">skip_serializing_if</span> <span class="op">=</span> <span class="string">&quot;AttackBonus::is_default&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">default</span>)]</span>
    <span class="doccomment">/**
    `bonus: &lt;AttackBonus&gt;?`

    Specifies the ability score to generate the normal bonus for the attack from, in addition to the proficiency bonus and any magic also included. See [`AttackBonus`].

    Note that while this property is not required, it is not an &quot;optional&quot; type, as the value has a &#39;default&#39; of its own.
    */</span>
    <span class="kw">pub</span> <span class="ident">bonus</span>: <span class="ident">AttackBonus</span>, 
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">skip_serializing_if</span> <span class="op">=</span> <span class="string">&quot;Option::is_none&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">default</span>)]</span>
    <span class="doccomment">/**
    `magic: option(&lt;integer&gt;)?`

    Specifies a fixed bonus (or penalty) to add to the hit roll, in addition to the ability and proficiency bonus. Not specifying this implies a value of 0.
    */</span>
    <span class="kw">pub</span> <span class="ident">magic</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">i8</span><span class="op">&gt;</span>, <span class="comment">// to add additional bonus onto a calculated attack.</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">skip_serializing_if</span> <span class="op">=</span> <span class="string">&quot;Option::is_none&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">default</span>)]</span>
    <span class="doccomment">/**
    `reach: option(&lt;integer&gt;)?`

    Specifies that this can be a melee attack, and that this value is the reach.
    */</span>
    <span class="kw">pub</span> <span class="ident">reach</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span>, <span class="comment">// indicates that it&#39;s a melee attack and this is the reach.</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">skip_serializing_if</span> <span class="op">=</span> <span class="string">&quot;Option::is_none&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">default</span>)]</span>
    <span class="doccomment">/**
    `range: option(&lt;integer&gt;)?`
    
    Specifies that this can be a ranged attack, and that this value is the range.
    */</span>
    <span class="kw">pub</span> <span class="ident">range</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">u16</span><span class="op">&gt;</span>, <span class="comment">// indicates that it&#39;s a ranged attack and this is the (short) range</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">skip_serializing_if</span> <span class="op">=</span> <span class="string">&quot;Option::is_none&quot;</span>)]</span>
    <span class="attribute">#[<span class="ident">serde</span>(<span class="ident">default</span>)]</span>
    <span class="doccomment">/**
    `range: option(&lt;integer&gt;)?`
    
    Specifies the long range for a ranged attack. This is ignored unless `range` is also set.
    */</span>
    <span class="kw">pub</span> <span class="ident">long_range</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">u16</span><span class="op">&gt;</span>, <span class="comment">// indicates that it&#39;s a ranged attack and this is the long range (requires &quot;range&quot;),</span>
    <span class="doccomment">/**
    `target: &lt;string&gt;`

    Specifies the phrasing for the target of the attack. Usually &quot;one creature&quot;, but occasionally its &quot;one target&quot;, and even rarely something like &quot;two Large or Smaller humanoids&quot;.
    */</span> 
    <span class="kw">pub</span> <span class="ident">target</span>: <span class="ident">String</span>, <span class="comment">// indicates the type of targets (i.e. &quot;one creature&quot;, &quot;one target&quot;, &quot;two Large or smaller humanoids&quot;, etc.)</span>
}

<span class="kw">impl</span> <span class="ident">Attack</span> {

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">get_description</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">effect</span>: <span class="kw-2">&amp;</span><span class="ident">AttackEffect</span>, <span class="ident">compound_effect</span>: <span class="kw-2">&amp;</span><span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">CompoundAttackEffect</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">String</span> {
    
        <span class="kw">let</span> (<span class="ident">target</span>,<span class="ident">melee</span>,<span class="ident">ranged</span>) <span class="op">=</span> <span class="kw">match</span> (<span class="self">self</span>.<span class="ident">reach</span>,<span class="self">self</span>.<span class="ident">range</span>,<span class="self">self</span>.<span class="ident">long_range</span>) {
            (<span class="prelude-val">Some</span>(<span class="ident">reach</span>),<span class="prelude-val">Some</span>(<span class="ident">short_range</span>),<span class="prelude-val">Some</span>(<span class="ident">long_range</span>)) <span class="op">=</span><span class="op">&gt;</span> 
                (<span class="macro">format!</span>(<span class="string">&quot;reach {} ft. or range {}/{} ft., {}&quot;</span>,<span class="ident">reach</span>,<span class="ident">short_range</span>,<span class="ident">long_range</span>,<span class="self">self</span>.<span class="ident">target</span>),<span class="bool-val">true</span>,<span class="bool-val">true</span>),
            (<span class="prelude-val">Some</span>(<span class="ident">reach</span>),<span class="prelude-val">Some</span>(<span class="ident">range</span>),<span class="prelude-val">None</span>) <span class="op">=</span><span class="op">&gt;</span> 
                (<span class="macro">format!</span>(<span class="string">&quot;reach {} ft. or range {} ft., {}&quot;</span>,<span class="ident">reach</span>,<span class="ident">range</span>,<span class="self">self</span>.<span class="ident">target</span>),<span class="bool-val">true</span>,<span class="bool-val">true</span>),
            (<span class="prelude-val">Some</span>(<span class="ident">reach</span>),<span class="prelude-val">None</span>,<span class="kw">_</span>) <span class="op">=</span><span class="op">&gt;</span> 
                (<span class="macro">format!</span>(<span class="string">&quot;reach {} ft., {}&quot;</span>,<span class="ident">reach</span>,<span class="self">self</span>.<span class="ident">target</span>),<span class="bool-val">true</span>,<span class="bool-val">false</span>),
            (<span class="prelude-val">None</span>,<span class="prelude-val">Some</span>(<span class="ident">short_range</span>),<span class="prelude-val">Some</span>(<span class="ident">long_range</span>)) <span class="op">=</span><span class="op">&gt;</span> 
                (<span class="macro">format!</span>(<span class="string">&quot;range {}/{} ft., {}&quot;</span>,<span class="ident">short_range</span>,<span class="ident">long_range</span>,<span class="self">self</span>.<span class="ident">target</span>),<span class="bool-val">false</span>,<span class="bool-val">true</span>),
            (<span class="prelude-val">None</span>,<span class="prelude-val">Some</span>(<span class="ident">range</span>),<span class="prelude-val">None</span>) <span class="op">=</span><span class="op">&gt;</span> 
                (<span class="macro">format!</span>(<span class="string">&quot;range {} ft., {}&quot;</span>,<span class="ident">range</span>,<span class="self">self</span>.<span class="ident">target</span>),<span class="bool-val">false</span>,<span class="bool-val">true</span>),
            (<span class="prelude-val">None</span>,<span class="prelude-val">None</span>,<span class="kw">_</span>) <span class="op">=</span><span class="op">&gt;</span> 
                (<span class="macro">format!</span>(<span class="string">&quot;{}&quot;</span>,<span class="self">self</span>.<span class="ident">target</span>),<span class="bool-val">false</span>,<span class="bool-val">false</span>)
        };
        <span class="kw">let</span> <span class="ident">attack_type</span> <span class="op">=</span> <span class="kw">match</span> <span class="self">self</span>.<span class="ident">type_</span> {
            <span class="prelude-val">Some</span>(<span class="ident">AttackType::Weapon</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="string">&quot;Weapon &quot;</span>,
            <span class="prelude-val">Some</span>(<span class="ident">AttackType::Spell</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="string">&quot;Spell &quot;</span>,
            <span class="prelude-val">None</span> <span class="op">=</span><span class="op">&gt;</span> <span class="string">&quot;&quot;</span>
        };
        <span class="kw">let</span> (<span class="ident">attack</span>,<span class="ident">default_bonus</span>) <span class="op">=</span> <span class="kw">match</span>(<span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">bonus</span>,<span class="self">self</span>.<span class="ident">magic</span>,<span class="ident">melee</span>,<span class="ident">ranged</span>) {
            (<span class="ident">bonus</span>,<span class="prelude-val">Some</span>(<span class="ident">magic</span>),<span class="bool-val">true</span>,<span class="bool-val">true</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}Melee or Ranged {}Attack:${{)}} ${{+{} + {}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;atk&quot;</span>,<span class="bool-val">true</span>),<span class="ident">magic</span>,<span class="ident">target</span>),<span class="string">&quot;atk&quot;</span>),
            (<span class="ident">bonus</span>,<span class="prelude-val">None</span>,<span class="bool-val">true</span>,<span class="bool-val">true</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}Melee or Ranged {}Attack:${{)}} ${{+{}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;atk&quot;</span>,<span class="bool-val">true</span>),<span class="ident">target</span>),<span class="string">&quot;atk&quot;</span>),
            (<span class="ident">bonus</span>,<span class="prelude-val">Some</span>(<span class="ident">magic</span>),<span class="bool-val">true</span>,<span class="bool-val">false</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}Melee {}Attack:${{)}} ${{+{} + {}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;str&quot;</span>,<span class="bool-val">true</span>),<span class="ident">magic</span>,<span class="ident">target</span>),<span class="string">&quot;str&quot;</span>),
            (<span class="ident">bonus</span>,<span class="prelude-val">None</span>,<span class="bool-val">true</span>,<span class="bool-val">false</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}Melee {}Attack:${{)}} ${{+{}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;str&quot;</span>,<span class="bool-val">true</span>),<span class="ident">target</span>),<span class="string">&quot;str&quot;</span>),
            (<span class="ident">bonus</span>,<span class="prelude-val">Some</span>(<span class="ident">magic</span>),<span class="bool-val">false</span>,<span class="bool-val">true</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}Ranged {}Attack:${{)}} ${{+{} + {}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;dex&quot;</span>,<span class="bool-val">true</span>),<span class="ident">magic</span>,<span class="ident">target</span>),<span class="string">&quot;dex&quot;</span>),
            (<span class="ident">bonus</span>,<span class="prelude-val">None</span>,<span class="bool-val">false</span>,<span class="bool-val">true</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}Ranged {}Attack:${{)}} ${{+{}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;dex&quot;</span>,<span class="bool-val">true</span>),<span class="ident">target</span>),<span class="string">&quot;dex&quot;</span>),
            (<span class="ident">bonus</span>,<span class="prelude-val">Some</span>(<span class="ident">magic</span>),<span class="bool-val">false</span>,<span class="bool-val">false</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}{}Attack:${{)}} ${{+{} + {}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;atk&quot;</span>,<span class="bool-val">true</span>),<span class="ident">magic</span>,<span class="ident">target</span>),<span class="string">&quot;atk&quot;</span>),
            (<span class="ident">bonus</span>,<span class="prelude-val">None</span>,<span class="bool-val">false</span>,<span class="bool-val">false</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="macro">format!</span>(<span class="string">&quot;${{italic(}}{}Attack:${{)}} ${{+{}}} to hit, {}.&quot;</span>,<span class="ident">attack_type</span>,<span class="ident">bonus</span>.<span class="ident">get_expr</span>(<span class="string">&quot;atk&quot;</span>,<span class="bool-val">true</span>),<span class="ident">target</span>),<span class="string">&quot;atk&quot;</span>),
        };
        <span class="kw">let</span> <span class="ident">effect</span> <span class="op">=</span> <span class="macro">format!</span>(<span class="string">&quot;${{italic(}}Hit:${{)}} {}&quot;</span>,<span class="ident">effect</span>.<span class="ident">get_description</span>(<span class="ident">default_bonus</span>,<span class="ident">compound_effect</span>));
        <span class="macro">format!</span>(<span class="string">&quot;{} {}&quot;</span>,<span class="ident">attack</span>,<span class="ident">effect</span>)
    }    
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">PartialEq</span>,<span class="ident">Debug</span>,<span class="ident">Clone</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Serialize</span>,<span class="ident">Deserialize</span>)]</span>
<span class="doccomment">/**
These values are used to represent standard weapons in attacks. Custom weapons are made by added custom attack actions. All weapons take an integer which represents a bonus (or penalty) to be added to attack and damage rolls, such as might come from a magic weapon.
*/</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">Weapon</span> { 

    <span class="comment">// unarmed</span>
    <span class="doccomment">/// `UnarmedStrike(&lt;integer&gt;)`</span>
    <span class="ident">UnarmedStrike</span>(<span class="ident">i8</span>),

    <span class="comment">// simple melee</span>
    <span class="doccomment">/// `Club(&lt;integer&gt;)`</span>
    <span class="ident">Club</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Dagger(&lt;integer&gt;)`</span>
    <span class="ident">Dagger</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Greatclub(&lt;integer&gt;)`</span>
    <span class="ident">Greatclub</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Handaxe(&lt;integer&gt;)`</span>
    <span class="ident">Handaxe</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Javelin(&lt;integer&gt;)`</span>
    <span class="ident">Javelin</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `LightHammer(&lt;integer&gt;)`</span>
    <span class="ident">LightHammer</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Mace(&lt;integer&gt;)`</span>
    <span class="ident">Mace</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Quarterstaff(&lt;integer&gt;)`</span>
    <span class="ident">Quarterstaff</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Sickle(&lt;integer&gt;)`</span>
    <span class="ident">Sickle</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Spear(&lt;integer&gt;)`</span>
    <span class="ident">Spear</span>(<span class="ident">i8</span>),
    <span class="comment">// simple ranged</span>
    <span class="doccomment">/// `LightCrossbow(&lt;integer&gt;)`</span>
    <span class="ident">LightCrossbow</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Dart(&lt;integer&gt;)`</span>
    <span class="ident">Dart</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Shortbow(&lt;integer&gt;)`</span>
    <span class="ident">Shortbow</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Sling(&lt;integer&gt;)`</span>
    <span class="ident">Sling</span>(<span class="ident">i8</span>),
    <span class="comment">// martial melee</span>
    <span class="doccomment">/// `Battleaxe(&lt;integer&gt;)`</span>
    <span class="ident">Battleaxe</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Flail(&lt;integer&gt;)`</span>
    <span class="ident">Flail</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Glaive(&lt;integer&gt;)`</span>
    <span class="ident">Glaive</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Greataxe(&lt;integer&gt;)`</span>
    <span class="ident">Greataxe</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Greatsword(&lt;integer&gt;)`</span>
    <span class="ident">Greatsword</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Halberd(&lt;integer&gt;)`</span>
    <span class="ident">Halberd</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Lance(&lt;integer&gt;)`</span>
    <span class="ident">Lance</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Longsword(&lt;integer&gt;)`</span>
    <span class="ident">Longsword</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Maul(&lt;integer&gt;)`</span>
    <span class="ident">Maul</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Morningstar(&lt;integer&gt;)`</span>
    <span class="ident">Morningstar</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Pike(&lt;integer&gt;)`</span>
    <span class="ident">Pike</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Rapier(&lt;integer&gt;)`</span>
    <span class="ident">Rapier</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Scimitar(&lt;integer&gt;)`</span>
    <span class="ident">Scimitar</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Shortsword(&lt;integer&gt;)`</span>
    <span class="ident">Shortsword</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Trident(&lt;integer&gt;)`</span>
    <span class="ident">Trident</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `WarPick(&lt;integer&gt;)`</span>
    <span class="ident">WarPick</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Warhammer(&lt;integer&gt;)`</span>
    <span class="ident">Warhammer</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Whip(&lt;integer&gt;)`</span>
    <span class="ident">Whip</span>(<span class="ident">i8</span>),
    <span class="comment">// martial ranged</span>
    <span class="doccomment">/// `Blowgun(&lt;integer&gt;)`</span>
    <span class="ident">Blowgun</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `HandCrossbow(&lt;integer&gt;)`</span>
    <span class="ident">HandCrossbow</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `HeavyCrossbow(&lt;integer&gt;)`</span>
    <span class="ident">HeavyCrossbow</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Longbow(&lt;integer&gt;)`</span>
    <span class="ident">Longbow</span>(<span class="ident">i8</span>),
    <span class="doccomment">/// `Net(&lt;integer&gt;)`</span>
    <span class="ident">Net</span>(<span class="ident">i8</span>),

}

<span class="kw">impl</span> <span class="ident">Weapon</span> {

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">get_attack</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">Attack</span> {
        <span class="comment">// Finnesse weapons use &#39;Best&#39; attack bonus.</span>
        <span class="comment">// Reach weapons get an extra five feet of reach</span>
        <span class="comment">// Thrown weapons get a &#39;range&#39; even if melee</span>
        <span class="kw">let</span> (<span class="ident">bonus</span>,<span class="ident">magic</span>,<span class="ident">reach</span>,<span class="ident">range</span>,<span class="ident">long_range</span>,<span class="ident">target</span>) <span class="op">=</span> <span class="kw">match</span> <span class="self">self</span> {
            <span class="ident">Weapon::UnarmedStrike</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Club</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Dagger</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        (<span class="ident">AttackBonus::Best</span>,      <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">Some</span>(<span class="number">20</span>),   <span class="prelude-val">Some</span>(<span class="number">60</span>),  <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Greatclub</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Handaxe</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">Some</span>(<span class="number">20</span>),   <span class="prelude-val">Some</span>(<span class="number">60</span>),  <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Javelin</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">Some</span>(<span class="number">30</span>),   <span class="prelude-val">Some</span>(<span class="number">120</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::LightHammer</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>   (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">Some</span>(<span class="number">20</span>),   <span class="prelude-val">Some</span>(<span class="number">60</span>),  <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Mace</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Quarterstaff</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>  (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Sickle</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Spear</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">Some</span>(<span class="number">20</span>),   <span class="prelude-val">Some</span>(<span class="number">60</span>),  <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            
            <span class="ident">Weapon::LightCrossbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">80</span>),   <span class="prelude-val">Some</span>(<span class="number">320</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Dart</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          (<span class="ident">AttackBonus::Best</span>,      <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">20</span>),   <span class="prelude-val">Some</span>(<span class="number">60</span>),  <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Shortbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>      (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">80</span>),   <span class="prelude-val">Some</span>(<span class="number">320</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Sling</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">30</span>),   <span class="prelude-val">Some</span>(<span class="number">120</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            
            <span class="ident">Weapon::Battleaxe</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Flail</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Glaive</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">10</span>),  <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Greataxe</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>      (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Greatsword</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>    (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Halberd</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">10</span>),  <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Lance</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">10</span>),  <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Longsword</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Maul</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Morningstar</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>   (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Pike</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">10</span>),  <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Rapier</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        (<span class="ident">AttackBonus::Best</span>,      <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Scimitar</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>      (<span class="ident">AttackBonus::Best</span>,      <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Shortsword</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>    (<span class="ident">AttackBonus::Best</span>,      <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Trident</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">Some</span>(<span class="number">20</span>),   <span class="prelude-val">Some</span>(<span class="number">60</span>),  <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::WarPick</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Warhammer</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     (<span class="ident">AttackBonus::Strength</span>,  <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">5</span>),   <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Whip</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          (<span class="ident">AttackBonus::Best</span>,      <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">Some</span>(<span class="number">10</span>),  <span class="prelude-val">None</span>,       <span class="prelude-val">None</span>,      <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            
            <span class="ident">Weapon::Blowgun</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">25</span>),   <span class="prelude-val">Some</span>(<span class="number">100</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::HandCrossbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>  (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">30</span>),   <span class="prelude-val">Some</span>(<span class="number">120</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::HeavyCrossbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">100</span>),  <span class="prelude-val">Some</span>(<span class="number">400</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Longbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">150</span>),  <span class="prelude-val">Some</span>(<span class="number">600</span>), <span class="string">&quot;one target&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Net</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>           (<span class="ident">AttackBonus::Dexterity</span>, <span class="prelude-val">Some</span>(<span class="kw-2">*</span><span class="ident">magic</span>),  <span class="prelude-val">None</span>,      <span class="prelude-val">Some</span>(<span class="number">5</span>),    <span class="prelude-val">Some</span>(<span class="number">15</span>),  <span class="string">&quot;one Large or smaller creature that is not formless&quot;</span>.<span class="ident">to_owned</span>()),
        };

        <span class="ident">Attack</span> {
            <span class="ident">type_</span>: <span class="prelude-val">Some</span>(<span class="ident">AttackType::Weapon</span>),
            <span class="ident">bonus</span>, 
            <span class="ident">magic</span>,
            <span class="ident">reach</span>,
            <span class="ident">range</span>,
            <span class="ident">long_range</span>,
            <span class="ident">target</span>,


        }

    }

    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">get_effect</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">size</span>: <span class="kw-2">&amp;</span><span class="ident">CreatureSize</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="ident">AttackEffect</span> {
        <span class="comment">// Versatile weapons should get an Or effect for the two hands</span>
        <span class="comment">// The net is a &quot;special&quot; weapon with a weird effects.</span>
        <span class="comment">// Damage Dice per size:</span>
        <span class="comment">// - Large: Double dice</span>
        <span class="comment">// - Huge: Triple dice</span>
        <span class="comment">// - Gargantuan: Quadruple Dice</span>
        
        <span class="kw">let</span> <span class="ident">size_factor</span> <span class="op">=</span> <span class="kw">match</span> <span class="ident">size</span> {
            <span class="ident">CreatureSize::Large</span> <span class="op">=</span><span class="op">&gt;</span> <span class="number">2</span>,
            <span class="ident">CreatureSize::Huge</span> <span class="op">=</span><span class="op">&gt;</span> <span class="number">3</span>,
            <span class="ident">CreatureSize::Gargantuan</span> <span class="op">=</span><span class="op">&gt;</span> <span class="number">4</span>,
            <span class="kw">_</span> <span class="op">=</span><span class="op">&gt;</span> <span class="number">1</span>
        };

        <span class="macro">macro_rules!</span> <span class="ident">dice</span> {
            (<span class="macro-nonterminal">$</span><span class="macro-nonterminal">coefficient</span>: <span class="ident">literal</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">die</span>: <span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">magic</span>: <span class="ident">ident</span>) <span class="op">=</span><span class="op">&gt;</span> {
                <span class="ident">DiceExpression::from_dice</span>(<span class="ident">Dice::new</span>(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">coefficient</span> <span class="op">*</span> <span class="ident">size_factor</span>, <span class="kw-2">&amp;</span><span class="ident">Die</span>::<span class="macro-nonterminal">$</span><span class="macro-nonterminal">die</span>),<span class="kw-2">*</span><span class="macro-nonterminal">$</span><span class="macro-nonterminal">magic</span> <span class="kw">as</span> <span class="ident">isize</span>)
            };
        }

        <span class="macro">macro_rules!</span> <span class="ident">die</span> {
            (<span class="macro-nonterminal">$</span><span class="macro-nonterminal">die</span>: <span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">magic</span>: <span class="ident">ident</span>) <span class="op">=</span><span class="op">&gt;</span> {
                <span class="macro">dice!</span>(<span class="number">1</span>,<span class="macro-nonterminal">$</span><span class="macro-nonterminal">die</span>,<span class="macro-nonterminal">$</span><span class="macro-nonterminal">magic</span>)
            };
        }

        <span class="macro">macro_rules!</span> <span class="ident">fixed</span> {
            (<span class="macro-nonterminal">$</span><span class="macro-nonterminal">magic</span>: <span class="ident">ident</span>) <span class="op">=</span><span class="op">&gt;</span> {
                (<span class="ident">size_factor</span> <span class="kw">as</span> <span class="ident">i8</span> <span class="op">+</span> <span class="kw-2">*</span><span class="macro-nonterminal">$</span><span class="macro-nonterminal">magic</span>).<span class="ident">max</span>(<span class="number">1</span>) <span class="kw">as</span> <span class="ident">u8</span> <span class="comment">// if it is always at least 1, then this can&#39;t panic</span>
            };
        }

        <span class="kw">match</span> <span class="self">self</span> {
            <span class="ident">Weapon::UnarmedStrike</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="ident">AttackEffect::FixedDamage</span>(<span class="macro">fixed!</span>(<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>, <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Club</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D4</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Dagger</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D4</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Best</span>,        <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Greatclub</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Handaxe</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Javelin</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::LightHammer</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>   <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D4</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Mace</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Quarterstaff</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>  <span class="ident">AttackEffect::Or</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>,
                                                             <span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>,
                                                             <span class="string">&quot;if used with two hands to make a melee attack&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Sickle</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D4</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Spear</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         <span class="ident">AttackEffect::Or</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Piercing</span>,
                                                             <span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Piercing</span>,
                                                             <span class="string">&quot;if used with two hands to make a melee attack&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::LightCrossbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Dexterity</span>,   <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Dart</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D4</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Best</span>,        <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Shortbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>      <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Dexterity</span>,   <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Sling</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D4</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Dexterity</span>,   <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Battleaxe</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     <span class="ident">AttackEffect::Or</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>,
                                                             <span class="macro">die!</span>(<span class="ident">D10</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>,
                                                             <span class="string">&quot;if used with two hands to make a melee attack&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Flail</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Glaive</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D10</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Greataxe</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>      <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D12</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Greatsword</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>    <span class="ident">AttackEffect::Damage</span>(<span class="macro">dice!</span>(<span class="number">2</span>,<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Halberd</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D10</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Lance</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>         <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D12</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Longsword</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     <span class="ident">AttackEffect::Or</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>,
                                                             <span class="macro">die!</span>(<span class="ident">D10</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Slashing</span>,
                                                             <span class="string">&quot;if used with two hands to make a melee attack&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Maul</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          <span class="ident">AttackEffect::Damage</span>(<span class="macro">dice!</span>(<span class="number">2</span>,<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Bludgeoning</span>),
            <span class="ident">Weapon::Morningstar</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>   <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Pike</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D10</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>,    <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Rapier</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>        <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Best</span>,    <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Scimitar</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>      <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Best</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Shortsword</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>    <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Best</span>,    <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Trident</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       <span class="ident">AttackEffect::Or</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>, <span class="ident">Damage::Piercing</span>,
                                                             <span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>, <span class="ident">Damage::Piercing</span>,
                                                             <span class="string">&quot;if used with two hands to make a melee attack&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::WarPick</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>, <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Warhammer</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>     <span class="ident">AttackEffect::Or</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>, <span class="ident">Damage::Bludgeoning</span>,
                                                             <span class="macro">die!</span>(<span class="ident">D10</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Strength</span>, <span class="ident">Damage::Bludgeoning</span>,
                                                             <span class="string">&quot;if used with two hands to make a melee attack&quot;</span>.<span class="ident">to_owned</span>()),
            <span class="ident">Weapon::Whip</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>          <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D4</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Best</span>,    <span class="ident">Damage::Slashing</span>),
            <span class="ident">Weapon::Blowgun</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       <span class="ident">AttackEffect::FixedDamage</span>(<span class="macro">fixed!</span>(<span class="ident">magic</span>), <span class="ident">AttackBonus::Default</span>, <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::HandCrossbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>  <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D6</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Default</span>, <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::HeavyCrossbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span> <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D10</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Default</span>, <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Longbow</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>       <span class="ident">AttackEffect::Damage</span>(<span class="macro">die!</span>(<span class="ident">D8</span>,<span class="ident">magic</span>), <span class="ident">AttackBonus::Default</span>, <span class="ident">Damage::Piercing</span>),
            <span class="ident">Weapon::Net</span>(<span class="ident">magic</span>) <span class="op">=</span><span class="op">&gt;</span>           <span class="ident">AttackEffect::Special</span>(<span class="macro">format!</span>(<span class="string">&quot;Creature is restrained until it is freed. The creature can use its action to make a DC ${{10 + {}}} Strength check, freeing itself or another creature within its reach on a success. Dealing ${{5 + {}}} slashing damage to the net (AC ${{10 + {}}}) also frees the creature without harmint it, ending the effect and destroying the net.&quot;</span>,<span class="ident">magic</span>,<span class="ident">magic</span>,<span class="ident">magic</span>)),
        }

    }
}

<span class="kw">impl</span> <span class="ident">std::fmt::Display</span> <span class="kw">for</span> <span class="ident">Weapon</span> {
    <span class="kw">fn</span> <span class="ident">fmt</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">f</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">std::fmt::Formatter</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span>(),<span class="ident">std::fmt::Error</span><span class="op">&gt;</span> {
        <span class="kw">let</span> (<span class="ident">name</span>,<span class="ident">bonus</span>) <span class="op">=</span> <span class="kw">match</span> <span class="self">self</span> {
            <span class="ident">Weapon::UnarmedStrike</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Unarmed Strike&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Club</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Club&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Dagger</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Dagger&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Greatclub</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Greatclub&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Handaxe</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Handaxe&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Javelin</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Javelin&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::LightHammer</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;LightHammer&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Mace</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Mace&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Quarterstaff</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Quarterstaff&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Sickle</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Sickle&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Spear</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Spear&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::LightCrossbow</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;LightCrossbow&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Dart</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Dart&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Shortbow</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Shortbow&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Sling</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Sling&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Battleaxe</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Battleaxe&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Flail</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Flail&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Glaive</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Glaive&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Greataxe</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Greataxe&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Greatsword</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Greatsword&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Halberd</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Halberd&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Lance</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Lance&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Longsword</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Longsword&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Maul</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Maul&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Morningstar</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Morningstar&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Pike</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Pike&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Rapier</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Rapier&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Scimitar</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Scimitar&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Shortsword</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Shortsword&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Trident</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Trident&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::WarPick</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;WarPick&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Warhammer</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Warhammer&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Whip</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Whip&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Blowgun</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Blowgun&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::HandCrossbow</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Hand Crossbow&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::HeavyCrossbow</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Heavy Crossbow&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Longbow</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Longbow&quot;</span>,<span class="ident">bonus</span>),
            <span class="ident">Weapon::Net</span>(<span class="ident">bonus</span>) <span class="op">=</span><span class="op">&gt;</span> (<span class="string">&quot;Net&quot;</span>,<span class="ident">bonus</span>),
        };
        <span class="kw">if</span> <span class="kw-2">*</span><span class="ident">bonus</span> <span class="op">!</span><span class="op">=</span> <span class="number">0</span> {
            <span class="macro">write!</span>(<span class="ident">f</span>,<span class="string">&quot;{} {:+}&quot;</span>,<span class="ident">name</span>,<span class="ident">bonus</span>)
        } <span class="kw">else</span> {
            <span class="macro">write!</span>(<span class="ident">f</span>,<span class="string">&quot;{}&quot;</span>,<span class="ident">name</span>)
        }
    }

}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">ParseWeaponError</span>;


<span class="kw">impl</span> <span class="ident">std::str::FromStr</span> <span class="kw">for</span> <span class="ident">Weapon</span> {
    <span class="kw">type</span> <span class="prelude-val">Err</span> <span class="op">=</span> <span class="ident">ParseWeaponError</span>;
    
    <span class="kw">fn</span> <span class="ident">from_str</span>(<span class="ident">s</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="self">Self</span>, <span class="ident"><span class="self">Self</span>::Err</span><span class="op">&gt;</span> {
        <span class="kw">let</span> (<span class="ident">name</span>,<span class="ident">bonus</span>) <span class="op">=</span> <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Some</span>((<span class="ident">name</span>,<span class="ident">bonus</span>)) <span class="op">=</span> <span class="ident">s</span>.<span class="ident">split_once</span>(<span class="string">&#39;+&#39;</span>) {
            (<span class="ident">name</span>,<span class="ident">bonus</span>.<span class="ident">parse</span>().<span class="ident">or_else</span>(<span class="op">|</span><span class="kw">_</span><span class="op">|</span> <span class="prelude-val">Err</span>(<span class="ident">ParseWeaponError</span>))<span class="question-mark">?</span>)
        } <span class="kw">else</span> {
            (<span class="ident">s</span>,<span class="number">0</span>)
        };
        <span class="kw">let</span> <span class="ident">weapon_fn</span> <span class="op">=</span> <span class="kw">match</span> <span class="ident">name</span>.<span class="ident">trim</span>().<span class="ident">to_lowercase</span>().<span class="ident">as_str</span>() {
            <span class="string">&quot;unarmed strike&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::UnarmedStrike</span>,
            <span class="string">&quot;club&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Club</span>,
            <span class="string">&quot;dagger&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Dagger</span>,
            <span class="string">&quot;greatclub&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Greatclub</span>,
            <span class="string">&quot;handaxe&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Handaxe</span>,
            <span class="string">&quot;javelin&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Javelin</span>,
            <span class="string">&quot;light hammer&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::LightHammer</span>,
            <span class="string">&quot;mace&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Mace</span>,
            <span class="string">&quot;quarterstaff&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Quarterstaff</span>,
            <span class="string">&quot;sickle&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Sickle</span>,
            <span class="string">&quot;spear&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Spear</span>,
            <span class="string">&quot;light crossbow&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::LightCrossbow</span>,
            <span class="string">&quot;dart&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Dart</span>,
            <span class="string">&quot;shortbow&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Shortbow</span>,
            <span class="string">&quot;sling&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Sling</span>,
            <span class="string">&quot;battleaxe&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Battleaxe</span>,
            <span class="string">&quot;flail&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Flail</span>,
            <span class="string">&quot;glaive&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Glaive</span>,
            <span class="string">&quot;greataxe&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Greataxe</span>,
            <span class="string">&quot;greatsword&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Greatsword</span>,
            <span class="string">&quot;halberd&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Halberd</span>,
            <span class="string">&quot;lance&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Lance</span>,
            <span class="string">&quot;longsword&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Longsword</span>,
            <span class="string">&quot;maul&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Maul</span>,
            <span class="string">&quot;morningstar&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Morningstar</span>,
            <span class="string">&quot;pike&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Pike</span>,
            <span class="string">&quot;rapier&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Rapier</span>,
            <span class="string">&quot;scimitar&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Scimitar</span>,
            <span class="string">&quot;shortsword&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Shortsword</span>,
            <span class="string">&quot;trident&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Trident</span>,
            <span class="string">&quot;war pick&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::WarPick</span>,
            <span class="string">&quot;warhammer&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Warhammer</span>,
            <span class="string">&quot;whip&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Whip</span>,
            <span class="string">&quot;blowgun&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Blowgun</span>,
            <span class="string">&quot;hand crossbow&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::HandCrossbow</span>,
            <span class="string">&quot;heavy crossbow&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::HeavyCrossbow</span>,
            <span class="string">&quot;longbow&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Longbow</span>,
            <span class="string">&quot;net&quot;</span> <span class="op">=</span><span class="op">&gt;</span> <span class="ident">Weapon::Net</span>,
            <span class="kw">_</span> <span class="op">=</span><span class="op">&gt;</span> <span class="prelude-val">Err</span>(<span class="ident">ParseWeaponError</span>)<span class="question-mark">?</span>
        };
        <span class="prelude-val">Ok</span>(<span class="ident">weapon_fn</span>(<span class="ident">bonus</span>))
    }    
}
</code></pre></div>
</section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="monstorr_lib" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div>
    <script src="../../main.js"></script><script src="../../source-script.js"></script><script src="../../source-files.js"></script>
</body></html>