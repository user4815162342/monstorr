<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="In Monstorr, interpolation is the process of substituting variables and expressions with actual values at the last minute. There are actually two types of interpolation that happen in Monstorr, one occurs during the generation of stat blocks from feature descriptions and other strings, the other occurs when including an external creature file into another (see [`crate::creature_commands::CreatureCommand::Include`]). They both work basically the same, but have slightly different inputs and outputs."><meta name="keywords" content="rust, rustlang, rust-lang, interpolation"><title>monstorr_lib::interpolation - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../monstorr_lib/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module interpolation</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div><div id="sidebar-vars" data-name="interpolation" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">monstorr_lib</a>::<wbr><a class="mod" href="#">interpolation</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/monstorr_lib/interpolation.rs.html#9-1122" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>In Monstorr, interpolation is the process of substituting variables and expressions with actual values at the last minute. There are actually two types of interpolation that happen in Monstorr, one occurs during the generation of stat blocks from feature descriptions and other strings, the other occurs when including an external creature file into another (see <a href="../creature_commands/enum.CreatureCommand.html#variant.Include" title="crate::creature_commands::CreatureCommand::Include"><code>crate::creature_commands::CreatureCommand::Include</code></a>). They both work basically the same, but have slightly different inputs and outputs.</p>
<p>Strings which can be interpolated contain normal text interspersed with interpolation expressions delimited from the rest. In order to make it easier to include feature interpolation strings inside an included document, the delimiters for feature interpolation and inclusion interpolation are different.</p>
<p>The result of an interpolation differs between the two modes. For inclusion, the result is a plain string that will then be deserialized into creature commands. For descriptions, however, the result is structured text.</p>
<h1 id="expression-delimiters" class="section-header"><a href="#expression-delimiters">Expression Delimiters</a></h1>
<p>When embedding interpolation in the included file, delimit expressions with ‘$&lt;…&gt;’. When embedding interpolation in features, delimit the expressions with ‘${…}’. </p>
<p>All text outside these delimiters are treated as normal text. While you can use the backslash (‘') to escape the dollar sign character (’$’), and other backslashes, this is not necessary unless, for some reason, you need to include the ‘${’ character combination in regular text, or worse, the ‘${’ character combination. In the former case you can produce that with ‘${’. In the latter, you can produce it with ‘\${’. Outside of those instances, a dollar sign and a backslash are treated as normal characters. In interpolating for inclusion, the same applies to ‘$&lt;’ and ‘$&lt;’ character combinations.</p>
<h1 id="expression-syntax" class="section-header"><a href="#expression-syntax">Expression Syntax</a></h1>
<p>The expression syntax is fairly simple. The following values operations are supported:</p>
<p><em>Variable References.</em> A plain identifier is a variable reference. Variables are provided by Monstorr according to the mode of interpolation. In inclusion, they are string values provided as arguments by the <code>Include</code> command, see <a href="../creature_commands/enum.CreatureCommand.html#variant.Include" title="crate::creature_commands::CreatureCommand::Include"><code>crate::creature_commands::CreatureCommand::Include</code></a>. In descriptions, the variables are properties of the creature, which may be strings, numbers or dice. For available creature properties, see <a href="../creature/struct.Creature.html" title="crate::creature::Creature"><code>crate::creature::Creature</code></a>. If the variable does not exist, or returns no value, an error will occur when it is referenced. </p>
<p><em>Strings</em>. Strings are delimited by double-quotes. They return a string value.</p>
<p><em>Numbers</em>. Only integers are supported, and consist of a series of decimal digits. They return a number value.</p>
<p><em>Dice.</em> Dice literals are supported in forms like “1d8” and “2d6”. Both numbers are required. They return a dice expression value. When a dice expression is converted to a string, it is formatted as in standard descriptions with the average followed by the actual expression in parentheses.</p>
<p><em>Parenthesis.</em> Expressions in between parentheses ‘(..)’ will be calculated first.</p>
<p><em>Properties and Index.</em> Some values returned by variables are objects that have properties, or lists that have indexes. Properties are accessed by using the ‘.’ operator followed by the property’s identifier. List items are accessed by using dot operator followed by a number indicating the index to access. </p>
<p><em>Negating Numbers.</em> The ‘-’ can be used before a number to negate it. The value must be a number, no other value types can be negated. Remember that if you negate a value that occurs after another expression, it may be confused with the minus operator. Use parentheses or replace it with ‘+ -’ to remove this ambiguity.</p>
<p><em>Signing Numbers and Dice.</em> Numbers and dice expressions can be signed, so that when they are formatted as strings, a ‘+’ appears before them if they are positive. The ‘-’ will always appear if they are negative. The ‘+’ operator which appears before the value will ensure that that takes place. It is infectious, so if you add other values to the expression, the final result of the expression will be formatted that way. Remember that if you sign a value that occurs after another expression, it may be confused with the plus operator. Use parentheses or replace it with ‘+ +’ to remove this ambiguity.</p>
<p><em>Stringifying Values.</em> Numbers and dice are automatically converted to strings when they are the final result of an expression. However, for type-safety, they are not if they are used in a more compound expression, and concatenating strings and non-strings is not allowed. This prevents you from making mistakes like ‘“foo” + 1 + 2’ when what you really meant was ‘“foo” (+1 + 2)’. The ‘$’ operator can be used before a number or dice value to convert it to a string, making concatenation possible.</p>
<p><em>Multiplication.</em> To multiply two number expressions, use the ‘*’ operator. You can multiply dice by numbers to get a new dice expression. If the number is not 1 or -1, then your dice expression will be formatted with a factor. You can not multiply two dice values together, as the result is undetermined. Remember, the coefficient of a dice value is not the same as a numeric factor: “2d6” is not the same as “1d6 x 2”, as they have different sets of possible results.</p>
<p><em>Division.</em> As only integer number values are allowed, it is necessary to know how to deal with fractions when dividing them. For that reason, there are two division operators. Use “/&lt;” to divide the numbers and round the result down, use “/&gt;” to divide the numbers and round the result up. Dice values can be divided by numbers, which will result in them having a factor expression when formatted. However, nothing can be divided by dice expressions, as the result of that is undetermined.</p>
<p><em>Addition, Subtraction and Concatenation.</em> To add and subtract number and dice values, use the “+” and “-” characters respectively. Adding dice together can create more complex dice expressions which involve several dice terms. If you add the same dice together, it should result in simply changing the coefficient. For example, “2d6 + 1d6” should result in “3d6”. However, “2d4 - 1d4” would not be the same as “1d4”, as they would have different sets of results (the first would have values ranging from -1 to 7, while the other has values ranging from 1-4, and that doesn’t even consider distribution )</p>
<p><em>Consecutive Expressions.</em> If two expressions are included consecutive to each other, then the results are both pushed out to the resulting string in order. For example, ‘“foo” “bar”’ would output the text “foobar”.</p>
<p><em>Structured Text Functions.</em> The result of interpolating a description is not just a simple string, it’s a list of text blocks that can contain styled text. The actual result is a list of <a href="../structured_text/enum.TextBlock.html" title="crate::structured_text::TextBlock"><code>crate::structured_text::TextBlock</code></a>s. There are two kinds of text blocks, and each of these can contain lists of four different kinds of spans. These are achieved through special functions.</p>
<p>A structured text function consists of a keyword, followed by an optional parentheses expression. Unlike normal expressions, these parentheses can contain normal template text, thus “italic( } italicized text ${ )” can be done. There are four such functions, which modify the structured text output.</p>
<ul>
<li>
<p><code>par</code>: starts a new normal paragraph block, allowing you to break up your description text. There is a variant of this function which takes an argument in parentheses, but it should not be used, as it has the result of creating what looks like a new feature in the stat block.</p>
</li>
<li>
<p><code>sub(...)</code>, <code>sub</code>: starts a subparagraph, with a heading contained in the parenthesis. In official content, a subparagraph in this case would create a paragraph with a hanging indent. The heading is an optional emphasized text that will appear at the beginning of the first line. In the official content, subparagraphs are used in the metallic dragon breath weapons, and in spellcasting spell lists.</p>
</li>
<li>
<p>‘italic(…)’: sets the text enclosed in the parentheses as italic. Nesting italic text inside italic text is not allowed, as it has undetermined effects. You can nest bold text inside italics, however.</p>
</li>
<li>
<p>‘bold(…)’: sets the text enclosed in the parentheses as bold. Nesting bold text inside bold text is not allowed, as it has undetermined effects. You can nest italic text inside bold, however.</p>
</li>
</ul>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<p>For examples of interpolation, look at the built-in creatures, whose raw files can be retrieved using the validate command from the Monstorr command line.</p>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="struct" href="struct.Document.html" title="monstorr_lib::interpolation::Document struct">Document</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="struct" href="struct.InterpolationTokenizer.html" title="monstorr_lib::interpolation::InterpolationTokenizer struct">InterpolationTokenizer</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="struct" href="struct.OverriddenInterpolationObject.html" title="monstorr_lib::interpolation::OverriddenInterpolationObject struct">OverriddenInterpolationObject</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="struct" href="struct.TokenDetails.html" title="monstorr_lib::interpolation::TokenDetails struct">TokenDetails</a></div><div class="item-right docblock-short"></div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="enum" href="enum.InterpolationMode.html" title="monstorr_lib::interpolation::InterpolationMode enum">InterpolationMode</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="enum" href="enum.InterpolationOperation.html" title="monstorr_lib::interpolation::InterpolationOperation enum">InterpolationOperation</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="enum" href="enum.InterpolationState.html" title="monstorr_lib::interpolation::InterpolationState enum">InterpolationState</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="enum" href="enum.InterpolationValue.html" title="monstorr_lib::interpolation::InterpolationValue enum">InterpolationValue</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="enum" href="enum.StructureKeyword.html" title="monstorr_lib::interpolation::StructureKeyword enum">StructureKeyword</a></div><div class="item-right docblock-short"></div></div><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="trait" href="trait.InterpolationObject.html" title="monstorr_lib::interpolation::InterpolationObject trait">InterpolationObject</a></div><div class="item-right docblock-short"></div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-left module-item"><a class="fn" href="fn.interpolate_str_for_deserialization.html" title="monstorr_lib::interpolation::interpolate_str_for_deserialization fn">interpolate_str_for_deserialization</a></div><div class="item-right docblock-short"></div><div class="item-left module-item"><a class="fn" href="fn.interpolate_str_for_statblock.html" title="monstorr_lib::interpolation::interpolate_str_for_statblock fn">interpolate_str_for_statblock</a></div><div class="item-right docblock-short"></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="monstorr_lib" data-search-index-js="../../search-index.js" data-search-js="../../search.js"></div>
    <script src="../../main.js"></script>
</body></html>